\section{Sterowanie pojazdem}
    Sterowanie pojazdem powinno odbywać się w sposób płynny i precyzyjny.
    W poniższym rozdziale zostaną omówione algorytmy, odpowiedzialne za najbardziej podstawowe funkcje poruszania się takie jak: jazda prosto, skręt oraz cofanie.

    \subsection{Jazda przez pewien odcinek}
    \label{subsec:jazda_przez_odcinek}
        W rozdziale \ref{section:jazda_prosto}, zostały opisane problemy jakie wystąpiły podczas budowy pojazdu. %oraz problemy jakie musiały zostać rozwiązane aby samochód był w stanie jechać prosto.
        Dzięki rozwiązaniu wyżej wymienionych problemów, pojazd był w stanie jechać prosto.
        Jednak dla precyzyjnego sterowania, informacja o tym, że pojazd porusza po linii prostej, jest niewystarczająca.
        Obowiązkowym jest poznanie odległości jaką pokonuje pojazd.

        Wartość odległości jaką pokonuje pojazd od momentu startu, możemy dość dokładnie obliczyć, korzystając ze wzoru \eqref{eq:pulseToDistance}.
        \begin{gather}
            s = \frac{\text{pulse} \cdot 2\pi R}{N}
            \label{eq:pulseToDistance}
        \end{gather}
        gdzie:
        \begin{itemize}
            \item $s$ -- odległość jaką pokonał pojazd,
            \item $\text{pulse}$ -- liczba impulsów z enkodera,
            \item $R$ -- promień koła,
            \item $N$ -- liczba impulsów na obrót koła.
        \end{itemize}

        Wzór ten, można także przekształcić w drugą stronę, aby obliczyć ile impulsów enkodera musi zostać zliczonych, przez procesor aby pojazd pokonał zadaną odległość.
        \begin{gather}
            \text{pulse} = \frac{s \cdot N}{2\pi R}
            \label{eq:distanceToPulse}
        \end{gather}

        Dla zbudowanego modelu, promień koła wynosi $R = 50cm$, a liczba impulsów zgodnie z dokumentacją wynosi $N = 1920$.
        A więc dokładność pomiaru odległości wynosi około:
        \begin{gather}
            \Delta s \approx \pm2.0mm
        \end{gather}


    \subsection{Wyznaczanie zakrętów}
        Wyznaczenie idealnie prostej trasy dla pojazdów nie zawsze jest możliwe.
        W trakcie jazdy, pojazd będzie skręcał wielotonie, w każdym możliwym kierunku.
        Dlatego niezwykle ważne jest, aby zachować maksymalną precyzję podczas skręcania.

        Aby wyznaczyć w jaki sposób nasz samochód powinien skręcić, musi wyznaczyć kilka podstawowych parametrów.
        A są to:
        \begin{itemize}
            \item długość łuku,
            \item promień skrętu,
            \item kąt skrętu kół.
        \end{itemize}
        Na tej podstawie, możemy stworzyć zależność, która pozwoli na napisanie instrukcji dla samochodu, w jaki sposób ma się poruszać.
        \begin{gather}
            s = 2\pi (r(\gamma) + \Delta r) \cdot \frac{\alpha}{360}
            \label{eq:turning_arc}
            \\
            \alpha = \frac{2\pi (r(\gamma + \Delta r))}{s \cdot 360}
        \end{gather}
        gdzie:
        \begin{itemize}
            \item $s$ -- długość łuku,
            \item $r(\gamma)$ -- promień skrętu wyznaczany zgodnie z równaniem \eqref{eq:turning_radius},
            \item $\Delta r$ -- odległość między kołami,
            \item $\alpha$ -- oczekiwany kąt skrętu.
        \end{itemize}

        Dzięki rozważaniom z rozdziału \ref{subsec:sterowanie_odległość}, oraz równaniu \eqref{eq:turning_arc} i \eqref{eq:turning_radius}.
        Możemy stworzyć prostą logikę odpowiedzialną za skręcanie pojazdu.


        \subsubsection{Minimalny promień skrętu}
        \label{subsubsec:minamalny_promien}
            Wyznaczenie promienia skrętu jest 
            \begin{gather}
                2\pi (r + \Delta r) \cdot \frac{\Delta \alpha}{360^\circ} = s\\
                r + \Delta r = \frac{s}{2\pi \cdot \frac{\Delta \alpha}{360^\circ}}
            \end{gather}
            gdzie:
            \begin{itemize}
                \item $r + \Delta r$ -- promień skrętu zewnętrznego koła,
                \item $\Delta \alpha$ -- zakreślony kąt,
                \item $s$ -- długość łuku.
            \end{itemize}

            Zbudowany pojazd, ma możliwość jazdy przez zadaną odległość. 
            Odległość pokonana przez samochód jest dość precyzyjne mierzona przez enkodery,
            a pomiary odległości za pomocą czujników ToF pozwalają na zaufanie dla wartości zadanej.

            Dzięki rozważaniom z rozdziału \ref{subsubsec:dyferencjal} udało się uzyskać powtarzalności pomiarów zakreślonego kąta.
            I tak przykładowo, dla ustawionego maksymalnego kąta skrętu kół $\gamma = 90 \pm 30^\circ$ oraz długości łuku $s = 500mm$, wartość zakreślony kąt wynosił około $\Delta \alpha = \left(60.0 \pm 3.0\right)^\circ$.
            Wartość promienia skrętu wynosiła około:
            \begin{gather}
                r = \frac{500mm}{2\pi \cdot \frac{60}{360}} - 125mm \approx (350)mm
            \end{gather}

            Przedstawiony minimalny promień skrętu, możemy oczywiści porównać zgodnie z równaniem \eqref{eq:turning_radius}.
            Po podstawieniu wyżej wymienionych wartości, otrzymujemy:
            \begin{gather}
                r(\gamma = 90 \pm 30^\circ) = \left|\frac{155}{\tan(\pm 30^\circ)}\right| \approx 270mm
            \end{gather}

            Teoretyczny minimalny promień skręty, wychodzący z obliczeń, jest znacząco mniejszy od zmierzonego minimalnego promienia skrętu.
            Wynika to z nie idealności konstrukcji, oraz zastosowania ,,względnie słabej jakości" serwomechanizmu.
            Pojazd nie jest w stanie skręcić kołami jednakowo w obie strony, co wymusiło ustawienie wartości offsetu, przesuwającej wartość kąta skrętu.
            Dla pojazdu testowego, wartość offsetu wynosiła $-6^\circ$. 
            Co ogranicza maksymalny zakres skrętu do $\pm 23^\circ$.
            \begin{gather}
                r(\gamma = 90 \pm 23^\circ) = \left|\frac{155}{\tan(\pm 23^\circ)}\right| \approx 350mm
            \end{gather}



        
